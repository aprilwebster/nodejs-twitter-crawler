var MAX_COUNT,Promise,TwitterClient,TwitterCrawler,_extend,extend,getLogger,isInt,slice=[].slice;TwitterClient=require("twitter"),Promise=require("bluebird"),_extend=require("extend"),extend=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],_extend.apply(null,[!0].concat(slice.call(e)))},MAX_COUNT=200,getLogger=function(e){return{info:console.info.bind(console),error:console.error.bind(console),debug:e?console.info.bind(console):function(){}}},isInt=function(e){return!isNaN(e)&&parseInt(Number(e))===e&&!isNaN(parseInt(e,10))},TwitterCrawler=function(){function e(e,t){null==t&&(t={}),this.setOptions(t),this.logger=getLogger(this.options.debug),this.count=0,this.createClients(e)}return e.prototype.createClients=function(e){return this.clients=[],e.forEach(function(e){return function(t){var n;return null!=t.enabled?(n=new TwitterClient(t),n._instance_id=e.clients.length,e.clients.push(n)):void 0}}(this))},e.prototype.setOptions=function(e){return this.options=extend({debug:!1},e)},e.prototype.getInstance=function(){var e;return e=this.count%this.clients.length,this.count++,this.logger.debug("Using twitter credentials nÂº"+e),this.clients[e]},e.prototype.callApi=function(){var e,t;if(t=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],"get"!==t&&"post"!==t)throw new Error("Method '"+t+"' not implemented.");return new Promise(function(n){return function(r,i){var o,s;return s=n.getInstance(),o=function(o,l){var c;return o?(c="Error calling '"+e[0]+"' api ["+t.toUpperCase()+"] on instance "+s._instance_id+".",32===o.code||o[0]&&32===o[0].code?(n.logger.error(c,"Using another instance.",o),n.callApi.apply(n,[t].concat(slice.call(e)))):(n.logger.error(c,o),i(o))):r(l)},s[t].apply(s,e.concat([o]))}}(this))},e.prototype.get=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],this.callApi.apply(this,["get"].concat(slice.call(e)))},e.prototype.post=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],this.callApi.apply(this,["post"].concat(slice.call(e)))},e.prototype._getTweets=function(e,t,n){return null==n&&(n=[]),new Promise(function(r){return function(i,o){var s;return s=function(s){var l,c;return r.logger.debug("Obtained",s.length,"for userId",e.user_id+".","Total tweets for user:",s.length+n.length),l=t.limit&&n.length+s.length>t.limit,s.length>1&&!l?r._getTweets(extend(e,{maxId:s[s.length-1].id-1}),t,n.concat(s)).done(i,o):(c=n.concat(s),t.limit&&(c=c.slice(0,+t.limit+1||9e9)),i(c))},r.get("statuses/user_timeline",e).done(s,o)}}(this))},e.prototype.getTweets=function(e,t){var n;return null==t&&(t={}),n={user_id:isInt(e)?e:void 0,screen_name:isInt(e)?void 0:e.replace("@",""),count:MAX_COUNT,exclude_replies:!0,trim_user:!0,maxId:void 0},this._getTweets(n,t)},e.prototype.getUser=function(e){var t;return t={user_id:isInt(e)?e:void 0,screen_name:isInt(e)?void 0:e.replace("@","")},this.get("users/show",t)},e}(),module.exports=TwitterCrawler;