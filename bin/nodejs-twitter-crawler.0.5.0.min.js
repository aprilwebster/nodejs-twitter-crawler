var MAX_COUNT,Promise,TwitterClient,TwitterCrawler,_extend,extend,slice=[].slice;TwitterClient=require("twitter"),Promise=require("promise"),_extend=require("extend"),extend=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],_extend.apply(null,[!0].concat(slice.call(t)))},MAX_COUNT=200,TwitterCrawler=function(){function t(t,e){null==e&&(e={}),this.setOptions(e),this.logger=getLogger(this.options.debug),this.createClients(t)}return t.prototype.createClients=function(t){return this.count=0,this.clients=[],t.forEach(function(t){return function(e){var n;return null!=e.enabled?(n=new TwitterClient(e),n._instance_id=t.clients.length,t.clients.push(n)):void 0}}(this))},t.prototype.setOptions=function(t){return this.options=extend({debug:!1},t)},t.prototype.getInstance=function(){var t;return t=this.count%this.clients.length,this.count++,this.logger.debug("Using twitter credentials nÂº"+t),this.clients[t]},t.prototype.callApi=function(){var t,e;if(e=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],"get"!==e&&"post"!==e)throw new Error("Method '"+e+"' not implemented.");return new Promise(function(n){return function(r,i){var l,s;return s=n.getInstance(),l=function(l,o){var c;return l?(c="Error calling '"+t[0]+"' api ["+e.toUpperCase()+"] on instance "+s._instance_id+".",32===l.code||l[0]&&32===l[0].code?(n.logger.error(c,"Using another instance.",l),n.callApi.apply(n,[e].concat(slice.call(t)))):(n.logger.error(c,l),i(l))):r(o)},s[e].apply(s,t.concat([l]))}}(this))},t.prototype.get=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],this.callApi.apply(this,["get"].concat(slice.call(t)))},t.prototype.post=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],this.callApi.apply(this,["post"].concat(slice.call(t)))},t.prototype._getTweets=function(t,e,n){return null==n&&(n=[]),new Promise(function(r){return function(i,l){var s;return s=function(s){var o,c;return r.logger("Obtained",s.length,"for userId",t.user_id+".","Total tweets for user:",s.length+n.length),o=e.limit&&n.length+s.length>e.limit,s.length>1&&!o?r._getTweets(extend(t,{maxId:s[s.length-1].id-1}),e,n.concat(s)).done(i,l):(c=n.concat(s),e.limit&&(c=c.slice(0,+e.limit+1||9e9)),i(c))},r.get("statuses/user_timeline",t).done(s,l)}}(this))},t.prototype.getTweets=function(t,e){var n;return null==e&&(e={}),n={user_id:t,count:MAX_COUNT,exclude_replies:!0,trim_user:!0,maxId:void 0},this._getTweets(n,e)},t.prototype.getUser=function(t){return this.get("users/show",{user_id:t})},t}(),module.exports=TwitterCrawler;