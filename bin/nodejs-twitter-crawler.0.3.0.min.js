var MAX_COUNT,Promise,TwitterClient,TwitterCrawler,_extend,extend,logger,slice=[].slice;TwitterClient=require("twitter"),Promise=require("promise"),_extend=require("extend"),extend=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],_extend.apply(null,[!0].concat(slice.call(t)))},MAX_COUNT=200,logger=console,TwitterCrawler=function(){function t(t){this.count=0,this.clients=[],t.forEach(function(t){return function(e){var n;return null!=e.enabled?(n=new TwitterClient(e),n._instance_id=t.clients.length,t.clients.push(n)):void 0}}(this))}return t.prototype.getInstance=function(){var t;return t=this.count%this.clients.length,this.count++,this.clients[t]},t.prototype.callApi=function(){var t,e;if(e=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],"get"!==e&&"post"!==e)throw new Error("Method '"+e+"' not implemented.");return new Promise(function(n){return function(r,i){var l,c;return c=n.getInstance(),l=function(l,o){var s;return l?(s="Error calling '"+t[0]+"' api ["+e.toUpperCase()+"] on instance "+c._instance_id+".",32===l.code||32===l[0].code?(logger.error(s,"Using another instance.",l),n.callApi.apply(n,[e].concat(slice.call(t)))):i(l)):r(o)},c[e].apply(c,t.concat([l]))}}(this))},t.prototype.get=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],this.callApi.apply(this,["get"].concat(slice.call(t)))},t.prototype.post=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],this.callApi.apply(this,["post"].concat(slice.call(t)))},t.prototype._getTweets=function(t,e,n){return null==n&&(n=[]),new Promise(function(r){return function(i,l){var c;return c=function(c){var o,s;return o=e.limit&&n.length+c.length>e.limit,c.length>1&&!o?r._getTweets(extend(t,{maxId:c[-1].id(-1)}),e,n.concat(c)).done(i,l):(s=n.concat(c),e.limit&&(s=s.slice(0,+e.limit+1||9e9)),i(s))},r.get("statuses/user_timeline",t).done(c,l)}}(this))},t.prototype.getTweets=function(t,e){var n;return null==e&&(e={}),n={user_id:t,count:MAX_COUNT,exclude_replies:!0,trim_user:!0,maxId:void 0},this._getTweets(n,e)},t.prototype.getUser=function(t){return this.get("users/show",{user_id:t})},t}(),module.exports=TwitterCrawler;